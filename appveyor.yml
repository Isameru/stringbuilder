# This file originates from the work of Mateusz Pusz (https://github.com/mpusz/opt) where is licensed under MIT License.

version: '1.1.{build}'

image: Visual Studio 2017

environment:
  matrix:
    - GENERATOR : "Visual Studio 15 Win64"
      CONFIG    : Debug

    - GENERATOR : "Visual Studio 15 Win64"
      CONFIG    : Release

platform:
  - x64

before_build:
  - cd "%APPVEYOR_BUILD_FOLDER%"
  - mkdir _build
  - cd _build
  - cmake -G"%GENERATOR%" -DCMAKE_BUILD_TYPE=%CONFIG% ..

build:
  project: "%APPVEYOR_BUILD_FOLDER%\\_build\\%APPVEYOR_PROJECT_NAME%.sln"

test_script:
  - "%APPVEYOR_BUILD_FOLDER%\\_build\\test\\%CONFIG%\\stringbuilder.c++17.test.exe -r xml -o %APPVEYOR_BUILD_FOLDER%\\_build\\test\\%CONFIG%\\stringbuilder.c++17.test.xml"
  - "%APPVEYOR_BUILD_FOLDER%\\_build\\test\\%CONFIG%\\stringbuilder.c++17.benchmark.exe"
  - pwd && ls -la

on_finish:
  - cd %APPVEYOR_BUILD_FOLDER%\\_build
  - ps: (new-object net.webclient).UploadFile("https://ci.appveyor.com/api/testresults/junit/$($env:APPVEYOR_JOB_ID)", (Resolve-Path ./test/Debug/stringbuilder.c++17.test.xml))
