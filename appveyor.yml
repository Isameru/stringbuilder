# This file originates from the work of Mateusz Pusz (https://github.com/mpusz/opt) where is licensed under MIT License.

version: 1.1.{build}

branches:
  except:
    - gh-pages

skip_commits:
  message: /\[ci skip\]/

image: Visual Studio 2017

platform:
  - x64
 
configuration:
  - Release
  - Debug

init:
  - git config --global core.autocrlf input

clone_depth: 5

install:
  - git submodule update --init --recursive

before_build:
  - mkdir _build && cd _build
  - cmake -G"Visual Studio 15 2017 Win64" ..

build:
  parallel: true
  project: $(APPVEYOR_BUILD_FOLDER)\_build\$(APPVEYOR_PROJECT_NAME).sln

test_script:
  - '%APPVEYOR_BUILD_FOLDER%\_build\test\%CONFIGURATION%\stringbuilder.c++17.test.exe -r xml -o stringbuilder.c++17.test.xml'
  - '%APPVEYOR_BUILD_FOLDER%\_build\test\%CONFIGURATION%\stringbuilder.c++17.benchmark.exe'

on_finish:
  - ps: (new-object net.webclient).UploadFile("https://ci.appveyor.com/api/testresults/junit/$($env:APPVEYOR_JOB_ID)", (Resolve-Path .\stringbuilder.c++17.test.xml))
